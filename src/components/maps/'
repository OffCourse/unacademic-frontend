import React from 'react';
import R from 'ramda';
import Point from './Point.jsx';
import SemiRegularPolygon from 'paths-js/semi-regular-polygon';

class Stop extends React.Component {

  constructor(props){
    super(props);
    this.radius = this.props.params.radius;
    this.state = { multiplier: 1, angle: 135 };
  }
  handleEnter(){
    this.setState({ multiplier: 2.5, angle: 195 });
  }

  handleLeave(){
    this.setState({multiplier: 1, angle: 135 });
  }

  render() {
    let { x, y, radius, checkpoint } = this.props.params;
    let { title, resources } = checkpoint;
    let { multiplier, angle }= this.state;

    let complete = checkpoint.complete && 'stop-is-complete';

    let stopClasses = `stop ${complete}`

    let transform = `rotate(${angle}, ${x}, ${y})`

    let numberOfResources = checkpoint.resources.length;

    let pointRadius = (radius /5) * multiplier;
    let strokeWidth = pointRadius / 2;

    let shape = SemiRegularPolygon({
      center: [x, y],
      radii: R.times(() => radius * multiplier, numberOfResources)
    });

    let points = R.mapIndexed(([cx, cy], index) => {
      return (
        <Point key={ index } cx={ cx } cy={ cy } strokeWidth={ strokeWidth }/>
      )
    }, shape.path.points());

    let point = <Point cx={ x } cy={ y } strokeWidth={ strokeWidth }/>

    return (
      <g transform={ transform }
        onMouseEnter={ this.handleEnter.bind(this) }
        onMouseLeave={ this.handleLeave.bind(this) }>
        <g>
          <path className={ stopClasses }
            strokeWidth={ strokeWidth }
            d={ shape.path.print() }/>
          { numberOfResources > 1 ? points : point }
        </g>
      </g>
    )
  }
};


export default Stop;
